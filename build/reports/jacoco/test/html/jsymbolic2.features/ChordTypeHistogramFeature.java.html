<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ru"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ChordTypeHistogramFeature.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jSymbolic2</a> &gt; <a href="index.source.html" class="el_package">jsymbolic2.features</a> &gt; <span class="el_source">ChordTypeHistogramFeature.java</span></div><h1>ChordTypeHistogramFeature.java</h1><pre class="source lang-java linenums">package jsymbolic2.features;

import jsymbolic2.featureutils.Feature;
import jsymbolic2.featureutils.ChordTypeEnum;
import jsymbolic2.featureutils.MIDIFeatureExtractor;
import jsymbolic2.processing.MIDIIntermediateRepresentations;
import ace.datatypes.FeatureDefinition;
import mckay.utilities.staticlibraries.MathAndStatsMethods;
import javax.sound.midi.Sequence;

/**
 * A feature vector consisting of bin magnitudes of the chord type histogram described in the jSymbolic
 * manual. This is a normalized histogram that has bins labeled with types of chords (in the following order
 * and with the indicated identifying codes): partial chords consisting of just two pitch classes [0], minor
 * triads [1], major triads [2], diminished triads [3], augmented triads [4], other triads [5], minor seventh
 * chords [6], dominant seventh chords [7], major seventh chords [8], other chords consisting of four pitch
 * classes [9], and complex chords with more than four pitch classes [10]. The bin magnitudes are calculated
 * by going through MIDI ticks one by one and incrementing the counter for the bin that corresponds to the
 * chord, if any, that is present during each given tick; the result is that the chords in this histogram are
 * weighted by the duration with which each chord is played. All inversions are treated as equivalent and
 * octave doubling is ignored in the calculation of this histogram. Melodic behaviour is not considered, so
 * arpeggios are not counted in this histogram.
 *
 * @author Tristano Tenaglia and Cory McKay
 */
<span class="fc" id="L26">public class ChordTypeHistogramFeature implements Feature {</span>

<span class="fc" id="L28">    final private int number_of_chord_types = ChordTypeEnum.values().length;</span>

    /**
     * {@inheritDoc}
     */
    @Override()
    public int getDimensions() {
<span class="fc" id="L35">        return number_of_chord_types;</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override()
    public String getName() {
<span class="fc" id="L43">        return &quot;Chord Type Histogram&quot;;</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override()
    public String getCode() {
<span class="fc" id="L51">        return &quot;C-3&quot;;</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override()
    public String getDescription() {
<span class="fc" id="L59">        return &quot;A feature vector consisting of bin magnitudes of the chord type histogram described in the jSymbolic manual. This is a normalized histogram that has bins labeled with types of chords (in the following order and with the indicated identifying codes): partial chords consisting of just two pitch classes [0], minor triads [1], major triads [2], diminished triads [3], augmented triads [4], other triads [5], minor seventh chords [6], dominant seventh chords [7], major seventh chords [8], other chords consisting of four pitch classes [9], and complex chords with more than four pitch classes [10]. The bin magnitudes are calculated by going through MIDI ticks one by one and incrementing the counter for the bin that corresponds to the chord, if any, that is present during eah given tick; the result is that the chords in this histogram are weighted by the duration with which each chord is played. All inversions are treated as equivalent and octave doubling is ignored in the calculation of this histogram. Melodic behaviour is not considered, so arpeggios are not counted in this histogram.&quot;;</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override()
    public double[] extractFeature(Sequence sequence, MIDIIntermediateRepresentations sequence_info, double[][] other_feature_values) throws Exception {
<span class="fc" id="L67">        double[] result = null;</span>
<span class="pc bpc" id="L68" title="1 of 2 branches missed.">        if (sequence_info != null) {</span>
            // The histogram to return
<span class="fc" id="L70">            result = new double[number_of_chord_types];</span>
            // The total number of pitch classes
<span class="fc" id="L72">            int number_pitch_classes = 12;</span>
            // The combined MIDI velocity of all (non-Channel 10) notes sounding on a MIDI tick by tick basis
<span class="fc" id="L74">            short[][] pitch_strength_by_tick_chart = sequence_info.pitch_strength_by_tick_chart;</span>
            // Count the chord types tick by tick
<span class="fc bfc" id="L76" title="All 2 branches covered.">            for (int tick = 0; tick &lt; pitch_strength_by_tick_chart.length; tick++) {</span>
                // Find the combined MIDI velocity of all (non-Channel 10) pitch classes sounding at this tick
<span class="fc" id="L78">                int[] pitch_class_strengths_this_tick = new int[number_pitch_classes];</span>
<span class="fc bfc" id="L79" title="All 2 branches covered.">                for (int pitch = 0; pitch &lt; pitch_strength_by_tick_chart[tick].length - 1; pitch++) {</span>
<span class="fc" id="L80">                    int pitch_class = pitch % number_pitch_classes;</span>
<span class="fc" id="L81">                    pitch_class_strengths_this_tick[pitch_class] += pitch_strength_by_tick_chart[tick][pitch];</span>
                }
                // Find the type of chord
<span class="fc" id="L84">                ChordTypeEnum chord_type = ChordTypeEnum.getChordType(pitch_class_strengths_this_tick);</span>
                // Update the histogram to reflect the chord on this tick
<span class="fc bfc" id="L86" title="All 2 branches covered.">                if (chord_type != null)</span>
<span class="fc" id="L87">                    result[chord_type.getChordTypeCode()] += 1;</span>
            }
            // Normalize the histogram
<span class="fc" id="L90">            result = MathAndStatsMethods.normalize(result);</span>
        }
<span class="fc" id="L92">        return result;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>