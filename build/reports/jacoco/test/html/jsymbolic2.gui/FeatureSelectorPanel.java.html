<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ru"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FeatureSelectorPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jSymbolic2</a> &gt; <a href="index.source.html" class="el_package">jsymbolic2.gui</a> &gt; <span class="el_source">FeatureSelectorPanel.java</span></div><h1>FeatureSelectorPanel.java</h1><pre class="source lang-java linenums">package jsymbolic2.gui;

import java.util.List;
import java.util.ArrayList;
import java.awt.*;
import java.awt.event.*;
import javax.swing.*;
import javax.swing.table.*;
import jsymbolic2.configuration.*;
import jsymbolic2.featureutils.Feature;
import jsymbolic2.featureutils.FeatureExtractorAccess;
import jsymbolic2.featureutils.MEIFeatureExtractor;
import jsymbolic2.featureutils.MIDIFeatureExtractor;
import mckay.utilities.gui.tables.TableMethods;
import mckay.utilities.staticlibraries.StringMethods;
import ace.datatypes.FeatureDefinition;

/**
 * A JPanel containing a table containing one row for each implemented feature, and whose first column
 * contains check boxes allowing users to select which features to save during feature extraction. This
 * feature table also allows users to view additional metadata about each feature, and still further metadata
 * can be seen for a feature (including its description and feature dependencies) by double clicking on its
 * row. Buttons are included for auto-selecting all features, no features or just the default features.
 * 
 * &lt;p&gt;The Feature Name column indicates the unique name of each feature, the Code column indicates its unique
 * code (feature group letter followed by the numerical identifier within the group), the Values column
 * indicates the number of dimensions (i.e. independent values) associated with the feature (any feature with
 * a Values entry greater than 1 is a feature vector rather than a single-value feature), the MEI-Only column
 * indicates whether a given feature can only be extracted from MEI files (such features should only be used
 * if features are exclusively being extracted from MEI files), and the Sequential column indicates whether a
 * given feature can be extracted for windows of a symbolic piece (a value of Yes means that the feature can
 * be extracted from either complete pieces or from individual windows, and a Value of No indicates that it
 * can only be extracted from complete pieces).&lt;/p&gt;
 *
 * &lt;p&gt;Note that some features need other features to first be calculated in order to be extracted themselves. 
 * So, even if a given feature is not explicitly selected for saving on this table, it will still be 
 * automatically extracted (but not saved) if another feature that is calculated based on it is in fact
 * selected for saving.&lt;/p&gt;
 * 
 * @author Cory McKay and Tristano Tenaglia
 */
public class FeatureSelectorPanel
	extends JPanel
	implements ActionListener
{
	/* FIELDS ***********************************************************************************************/
	
	
	/**
	 * Holds a reference to the JFrame that holds this FeatureSelectionPanel object.
	 */
	private final OuterFrame outer_frame;

	/**
	 * Hold one instance of each implemented feature.
	 */
	private final Feature[] all_feature_extractors;

	/**
	 * The default features to save during feature extraction. Ordering matches those of the features in the
	 * all_feature_extractors field.
	 */
	private final boolean[] feature_save_defaults;

	/**
	 * A table where each row corresponds to a different feature, and each implemented feature is listed
	 * exactly once. The first column holds a check box indicating whether that row's feature should be saved
	 * during feature extraction. The other columns hold metadata about the given row's feature.
	 */
	private JTable features_table;
	
	/**
	 * The table model for the features_table field.
	 */
	private FeatureSelectorTableModel features_table_model;

	/**
	 * A button causing the default features to be marked for extraction on the features_table.
	 */
	private JButton select_default_features_button;

	/**
	 * A button causing the all features to be marked for extraction on the features_table.
	 */
	private JButton select_all_features_button;

	/**
	 * A button causing no features to be marked for extraction on the features_table.
	 */
	private JButton deselect_all_features_button;
	
	
	/* CONSTRUCTOR ******************************************************************************************/
	
	
	/**
	 * Set up this JPanel's fields and GUI elements.
	 *
	 * @param outer_frame				The JFrame element that contains this JPanel.
	 * @param configuration_file_data	The configuration file data that will be used to initialize the 
	 *									features set to be saved. If null is provided here, then default 
	 *									features are set to be saved.
	 */
	public FeatureSelectorPanel(OuterFrame outer_frame, ConfigurationFileData configuration_file_data)
<span class="nc" id="L105">	{</span>
		// Store a reference to the containing JFrame
<span class="nc" id="L107">		this.outer_frame = outer_frame;</span>

		// Store informaation relating to feature extractors in this object's fields (including the particular
		// features initially set to be saved, as parsed from a config file if one is specified).
<span class="nc" id="L111">		all_feature_extractors = FeatureExtractorAccess.getAllImplementedFeatureExtractors();</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">		if (configuration_file_data != null)</span>
<span class="nc" id="L113">			feature_save_defaults = configuration_file_data.getFeaturesToSaveBoolean();</span>
<span class="nc" id="L114">		else feature_save_defaults = FeatureExtractorAccess.getDefaultFeaturesToSave();</span>
				
		// Set up the features_table and its features_table_model
<span class="nc" id="L117">		setUpFeatureTable();</span>

		// Set up the GUI elements on this JPanel
<span class="nc" id="L120">		formatAndAddGuiElements();</span>
		
		// Cause the table to respond to double clicks
<span class="nc" id="L123">		addTableMouseListener();	</span>
<span class="nc" id="L124">	}</span>
	
	
	/* PUBLIC METHODS ***************************************************************************************/
	
	
	/**
	 * Calls the appropriate method when one of the JButtons on this JPanel is pressed. Adjusts the features
	 * marked to be saved on the table based on the particular button pressed.
	 *
	 * @param event	The button-triggered event that is to be reacted to.
	 */
	@Override
	public void actionPerformed(ActionEvent event)
	{
<span class="nc bnc" id="L139" title="All 2 branches missed.">		if (event.getSource().equals(select_default_features_button))</span>
<span class="nc" id="L140">			features_table_model.setFeaturesMarkedForSaving(feature_save_defaults);</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">		else if (event.getSource().equals(select_all_features_button))</span>
		{
<span class="nc" id="L143">			boolean[] to_save = new boolean[features_table_model.getRowCount()];</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">			for (int i = 0; i &lt; to_save.length; i++)</span>
<span class="nc" id="L145">				to_save[i] = true;</span>
<span class="nc" id="L146">			features_table_model.setFeaturesMarkedForSaving(to_save);</span>
<span class="nc" id="L147">		}</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">		else if (event.getSource().equals(deselect_all_features_button))</span>
		{
<span class="nc" id="L150">			boolean[] to_save = new boolean[features_table_model.getRowCount()];</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">			for (int i = 0; i &lt; to_save.length; i++)</span>
<span class="nc" id="L152">				to_save[i] = false;</span>
<span class="nc" id="L153">			features_table_model.setFeaturesMarkedForSaving(to_save);</span>
		}
<span class="nc" id="L155">	}</span>


	/**
	 * Returns whether or not each of the features is marked to be saved on the features table, based on
	 * whether its check box is checked on the table.
	 *
	 * @return				Which features should be saved during feature extraction. The ordering of the 
	 *						returned booleans corresponds to the ordering of the features on the features
	 *						table.
	 * @throws Exception	An informative exception is thrown if no features have been selected for saving.
	 */
	public boolean[] getFeaturesToSave()
		throws Exception
	{
<span class="nc" id="L170">		boolean[] features_to_save = new boolean[all_feature_extractors.length];</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">		for (int i = 0; i &lt; features_to_save.length; i++)</span>
<span class="nc" id="L172">			features_to_save[i] = ((Boolean) features_table_model.getValueAt(i, 0));</span>
<span class="nc" id="L173">		return features_to_save;</span>
	}
	
	
	/**
	 * Returns a list of the names of all features currently selected on the features table to be saved. 
	 *
	 * @return				A list of the features marked for saving during feature extraction, in the order
	 *						that they appear on the features table.
	 * @throws Exception	An informative exception is thrown if no features have been selected for saving.
	 */
	public List&lt;String&gt; getNamesOfFeaturesToSave()
		throws Exception
	{
<span class="nc" id="L187">		boolean[] features_to_save = getFeaturesToSave();</span>
<span class="nc" id="L188">		List&lt;String&gt; names_of_features_to_save = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">		for (int i = 0; i &lt; features_to_save.length; i++)</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">			if (features_to_save[i] == true)</span>
<span class="nc" id="L191">				names_of_features_to_save.add(FeatureExtractorAccess.getNamesOfAllImplementedFeatures().get(i));</span>
<span class="nc" id="L192">		return names_of_features_to_save;</span>
	}

	
	/* PRIVATE METHODS **************************************************************************************/

	
	/**
	 * Initialize the features_table and features_table_model fields and format the features_table.
	 */
	private void setUpFeatureTable()
	{
		// Set the column headings and ordering
<span class="nc" id="L205">		Object[] column_names =</span>
		{
			&quot;Save&quot;,
			&quot;Feature Name&quot;,
			&quot;Code&quot;,
			&quot;Values&quot;,
			&quot;MEI-Only&quot;
			//&quot;Sequential&quot;
		};

		// Initialize features_table_model and features_table
<span class="nc" id="L216">		features_table_model = new FeatureSelectorTableModel(column_names, all_feature_extractors.length);</span>
<span class="nc" id="L217">		features_table_model.fillTable(all_feature_extractors, feature_save_defaults);</span>
<span class="nc" id="L218">		features_table = new JTable(features_table_model);</span>

		// Right-justify features_table columns
<span class="nc" id="L221">		DefaultTableCellRenderer right_column_renderer = new DefaultTableCellRenderer();</span>
<span class="nc" id="L222">		right_column_renderer.setHorizontalAlignment(JLabel.RIGHT);</span>
<span class="nc" id="L223">		features_table.getColumnModel().getColumn(2).setCellRenderer(right_column_renderer);</span>
<span class="nc" id="L224">		features_table.getColumnModel().getColumn(3).setCellRenderer(right_column_renderer);</span>
<span class="nc" id="L225">		features_table.getColumnModel().getColumn(4).setCellRenderer(right_column_renderer);</span>
		//features_table.getColumnModel().getColumn(5).setCellRenderer(right_column_renderer);
		
		// Resize features_table columns to fit the data
<span class="nc" id="L229">		TableMethods.sizeTableColumnsToFit(features_table, false);</span>
<span class="nc" id="L230">	}</span>

	
	/**
	 * Instantiate (where not done already), set up and lay out the various GUI components on this JPanel. Add 
	 * action listeners to buttons.
	 */
	private void formatAndAddGuiElements()
	{
		// Prepare this JPanel's basic layout settings
<span class="nc" id="L240">		int horizontal_gap = OuterFrame.HORIZONTAL_GAP; // horizontal space between GUI elements</span>
<span class="nc" id="L241">		int vertical_gap = OuterFrame.VERTICAL_GAP; // horizontal space between GUI elements</span>
<span class="nc" id="L242">		setLayout(new BorderLayout(horizontal_gap, vertical_gap));</span>

		// Add an overall title for this panel
<span class="nc" id="L245">		JLabel panel_label = new JLabel(&quot;FEATURES TO SAVE&quot;);</span>
<span class="nc" id="L246">		OuterFrame.formatLabel(panel_label);</span>
		
		// Set up the features table button panel
<span class="nc" id="L249">		select_default_features_button = new JButton(&quot;Select Default Features&quot;);</span>
<span class="nc" id="L250">		select_all_features_button = new JButton(&quot;Select All Features&quot;);</span>
<span class="nc" id="L251">		deselect_all_features_button = new JButton(&quot;Deselect All Features&quot;);</span>
<span class="nc" id="L252">		JPanel button_panel = new JPanel(new GridLayout(1, 3, horizontal_gap, vertical_gap));</span>
<span class="nc" id="L253">		button_panel.add(select_default_features_button);</span>
<span class="nc" id="L254">		button_panel.add(select_all_features_button);</span>
<span class="nc" id="L255">		button_panel.add(deselect_all_features_button);</span>
		
		// Add action listeners to buttons
<span class="nc" id="L258">		select_default_features_button.addActionListener(this);</span>
<span class="nc" id="L259">		select_all_features_button.addActionListener(this);</span>
<span class="nc" id="L260">		deselect_all_features_button.addActionListener(this);</span>

		// Make the features_table scrollable and place it on its own JPanel
<span class="nc" id="L263">		JScrollPane features_scroll_pane = new JScrollPane(features_table);</span>
<span class="nc" id="L264">		JPanel features_panel = new JPanel(new GridLayout(1, 1));</span>
<span class="nc" id="L265">		features_panel.add(features_scroll_pane);</span>

		// Add all GUI elements to this JPanel		
<span class="nc" id="L268">		add(panel_label, BorderLayout.NORTH);</span>
<span class="nc" id="L269">		add(features_panel, BorderLayout.CENTER);</span>
<span class="nc" id="L270">		add(button_panel, BorderLayout.SOUTH);</span>
<span class="nc" id="L271">		features_table_model.fireTableDataChanged();</span>
<span class="nc" id="L272">		repaint();</span>
<span class="nc" id="L273">		outer_frame.repaint();	</span>
<span class="nc" id="L274">	}</span>
	
	
	/**
	 * Makes it so that if a row is double clicked on, then a description of the row's corresponding feature
	 * is displayed in a pop-up window.
	 */
	private void addTableMouseListener()
	{
<span class="nc" id="L283">		features_table.addMouseListener</span>
<span class="nc" id="L284">		(</span>
			new MouseAdapter()
<span class="nc" id="L286">			{</span>
				@Override
				public void mouseClicked(MouseEvent event)
				{
<span class="nc bnc" id="L290" title="All 2 branches missed.">					if (event.getClickCount() == 2)</span>
					{
<span class="nc" id="L292">						int row_clicked = features_table.rowAtPoint(event.getPoint());</span>
<span class="nc" id="L293">						FeatureDefinition definition = all_feature_extractors[row_clicked].getFeatureDefinition();</span>
<span class="nc" id="L294">						boolean mei_specific = all_feature_extractors[row_clicked] instanceof MEIFeatureExtractor;</span>

<span class="nc" id="L296">						String text</span>
								= &quot;NAME: &quot; + definition.name + &quot;\n&quot;
<span class="nc" id="L298">								+ &quot;CODE: &quot; + all_feature_extractors[row_clicked].getCode() + &quot;\n&quot;</span>
								+ &quot;DESCRIPTION: &quot; + definition.description + &quot;\n&quot;
								+ &quot;DIMENSIONS: &quot; + definition.dimensions + &quot;\n&quot;
								+ &quot;MEI-SPECIFIC: &quot; + mei_specific + &quot;\n&quot;
								+ &quot;IS SEQUENTIAL: &quot; + definition.is_sequential + &quot;\n&quot;;

<span class="nc" id="L304">						String[] dependencies = all_feature_extractors[row_clicked].getDependencies();</span>
<span class="nc bnc" id="L305" title="All 2 branches missed.">						if (dependencies == null)</span>
<span class="nc" id="L306">							text += &quot;DEPENDENCIES: none&quot;;</span>
						else
						{
<span class="nc bnc" id="L309" title="All 2 branches missed.">							for (int dep = 0; dep &lt; dependencies.length; dep++)</span>
							{
<span class="nc" id="L311">								text += &quot;DEPENDENCY: &quot; + dependencies[dep];</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">								if (dep != dependencies.length - 1)</span>
<span class="nc" id="L313">									text += &quot;\n&quot;;</span>
							}
						}

<span class="nc" id="L317">						JOptionPane.showMessageDialog( outer_frame,</span>
<span class="nc" id="L318">													   StringMethods.wrapString(text, OuterFrame.DIALOG_BOX_MAX_CHARS_PER_LINE, OuterFrame.DIALOG_BOX_HANGING_INDENT_CHARS),</span>
													   &quot;Feature Metadata&quot;,
													   JOptionPane.INFORMATION_MESSAGE );
					}
<span class="nc" id="L322">				}</span>
			}
		);
<span class="nc" id="L325">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>