<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ru"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RelativeRangeIsolationOfLoudestVoiceFeature.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jsymbolic-core</a> &gt; <a href="index.source.html" class="el_package">jsymbolic2.features</a> &gt; <span class="el_source">RelativeRangeIsolationOfLoudestVoiceFeature.java</span></div><h1>RelativeRangeIsolationOfLoudestVoiceFeature.java</h1><pre class="source lang-java linenums">package jsymbolic2.features;

import javax.sound.midi.Sequence;
import java.util.List;
import ace.datatypes.FeatureDefinition;
import jsymbolic2.featureutils.MIDIFeatureExtractor;
import jsymbolic2.processing.MIDIIntermediateRepresentations;

/**
 * Number of pitched notes in the MIDI channel with the highest average loudness that fall outside the range
 * of any other pitched channel, divided by the total number of notes in the channel with the highest average
 * loudness. Set to 0 if there are only 0 or 1 channels containing pitched notes.
 *
 * @author Cory McKay and Tristano Tenaglia
 */
public class RelativeRangeIsolationOfLoudestVoiceFeature
		extends MIDIFeatureExtractor
{
	/* CONSTRUCTOR ******************************************************************************************/

	
	/**
	 * Basic constructor that sets the values of the fields inherited from this class' superclass.
	 */
	public RelativeRangeIsolationOfLoudestVoiceFeature()
<span class="fc" id="L26">	{</span>
<span class="fc" id="L27">		code = &quot;T-11&quot;;</span>
<span class="fc" id="L28">		name = &quot;Relative Range Isolation of Loudest Voice&quot;;</span>
<span class="fc" id="L29">		description = &quot;Number of pitched notes in the MIDI channel with the highest average loudness that fall outside the range of any other pitched channel, divided by the total number of notes in the channel with the highest average loudness. Set to 0 if there are only 0 or 1 channels containing pitched notes.&quot;;</span>

<span class="fc" id="L31">	}</span>
	

	/* PUBLIC METHODS ***************************************************************************************/
	
	
	/**
	 * Extract this feature from the given sequence of MIDI data and its associated information.
	 *
	 * @param sequence				The MIDI data to extract the feature from.
	 * @param sequence_info			Additional data already extracted from the the MIDI sequence.
	 * @param other_feature_values	The values of other features that may be needed to calculate this feature. 
	 *								The order and offsets of these features must be the same as those returned
	 *								by this class' getDependencies and getDependencyOffsets methods, 
	 *								respectively. The first indice indicates the feature/window, and the 
	 *								second indicates the value.
	 * @return						The extracted feature value(s).
	 * @throws Exception			Throws an informative exception if the feature cannot be calculated.
	 */
	@Override
	public double[] extractFeature( Sequence sequence,
									MIDIIntermediateRepresentations sequence_info,
									double[][] other_feature_values )
	throws Exception
	{
		double value;
<span class="pc bpc" id="L57" title="1 of 2 branches missed.">		if (sequence_info != null)</span>
		{
			// Get information from sequence_info 
<span class="fc" id="L60">			int[][] channel_statistics = sequence_info.channel_statistics;</span>
<span class="fc" id="L61">			List&lt;List&lt;Integer&gt;&gt; list_of_note_on_pitches_by_channel = sequence_info.list_of_note_on_pitches_by_channel;</span>

			// Find the loudest non-Channel 10 channel
<span class="fc" id="L64">			int index_of_loudest_channel = 0;</span>
<span class="fc" id="L65">			int loudness_of_loudest_channel = 0;</span>
<span class="fc bfc" id="L66" title="All 2 branches covered.">			for (int channel = 0; channel &lt; channel_statistics.length; channel++)</span>
			{
<span class="fc bfc" id="L68" title="All 2 branches covered.">				if (channel != 10 - 1) // not channel 10 (unpitched)</span>
				{
<span class="fc" id="L70">					int average_loudness_this_channel = channel_statistics[channel][2];</span>
<span class="fc bfc" id="L71" title="All 2 branches covered.">					if (average_loudness_this_channel &gt; loudness_of_loudest_channel)</span>
					{
<span class="fc" id="L73">						loudness_of_loudest_channel = average_loudness_this_channel;</span>
<span class="fc" id="L74">						index_of_loudest_channel = channel;</span>
					}
				}
			}

			// Find the lowest and highest pitches in all channels other than 10 and the loudest channel
<span class="fc" id="L80">			boolean another_pitched_voice_exists = false;</span>
<span class="fc" id="L81">			int lowest_pitch_in_non_loudest_voice = 127;</span>
<span class="fc" id="L82">			int hightest_pitch_in_non_loudest_voice = 0;</span>
<span class="fc bfc" id="L83" title="All 2 branches covered.">			for (int channel = 0; channel &lt; channel_statistics.length; channel++)</span>
			{
<span class="fc bfc" id="L85" title="All 4 branches covered.">				if (channel != index_of_loudest_channel &amp;&amp; channel != 10 - 1)</span>
				{
<span class="fc bfc" id="L87" title="All 2 branches covered.">					if (channel_statistics[channel][0] != 0)</span>
<span class="fc" id="L88">						another_pitched_voice_exists = true;</span>

<span class="fc" id="L90">					int lowest_pitch_this_channel = channel_statistics[channel][4];</span>
<span class="fc" id="L91">					int highest_pitch_this_channel = channel_statistics[channel][5];</span>
					
<span class="fc bfc" id="L93" title="All 2 branches covered.">					if (lowest_pitch_this_channel &lt; lowest_pitch_in_non_loudest_voice)</span>
<span class="fc" id="L94">						lowest_pitch_in_non_loudest_voice = lowest_pitch_this_channel;</span>
<span class="fc bfc" id="L95" title="All 2 branches covered.">					if (highest_pitch_this_channel &gt; hightest_pitch_in_non_loudest_voice)</span>
<span class="fc" id="L96">						hightest_pitch_in_non_loudest_voice = highest_pitch_this_channel;</span>
				}
			}
			
			// Find number of notes in the loudest channel outside the range of any other channels
<span class="fc" id="L101">			double notes_in_loudest_channel_outside_range = 0.0;</span>
<span class="fc" id="L102">			List&lt;Integer&gt; pitches_of_notes_in_loudest_channel = list_of_note_on_pitches_by_channel.get(index_of_loudest_channel);</span>
<span class="fc bfc" id="L103" title="All 2 branches covered.">			for (Integer this_pitch : pitches_of_notes_in_loudest_channel)</span>
<span class="fc bfc" id="L104" title="All 2 branches covered.">				if ( this_pitch &gt; hightest_pitch_in_non_loudest_voice ||</span>
<span class="fc bfc" id="L105" title="All 2 branches covered.">				     this_pitch &lt; lowest_pitch_in_non_loudest_voice)</span>
<span class="fc" id="L106">					notes_in_loudest_channel_outside_range++;</span>

			// Finalize results
<span class="fc bfc" id="L109" title="All 2 branches covered.">			if (another_pitched_voice_exists)</span>
			{
<span class="fc" id="L111">				double total_notes_in_loudest_voice = channel_statistics[index_of_loudest_channel][0];</span>
<span class="fc" id="L112">				value = notes_in_loudest_channel_outside_range / total_notes_in_loudest_voice;</span>
<span class="fc" id="L113">			}</span>
			else
<span class="fc" id="L115">				value = 0.0;</span>
<span class="fc" id="L116">		}</span>
<span class="nc" id="L117">		else value = -1.0;</span>

<span class="fc" id="L119">		double[] result = new double[1];</span>
<span class="fc" id="L120">		result[0] = value;</span>
<span class="fc" id="L121">		return result;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>