<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ru"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VerticalIntervalHistogramFeature.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jsymbolic-core</a> &gt; <a href="index.source.html" class="el_package">jsymbolic2.features</a> &gt; <span class="el_source">VerticalIntervalHistogramFeature.java</span></div><h1>VerticalIntervalHistogramFeature.java</h1><pre class="source lang-java linenums">package jsymbolic2.features;

import javax.sound.midi.*;
import ace.datatypes.FeatureDefinition;
import mckay.utilities.staticlibraries.MathAndStatsMethods;
import jsymbolic2.featureutils.MIDIFeatureExtractor;
import jsymbolic2.processing.MIDIIntermediateRepresentations;

/**
 * A feature vector consisting of bin magnitudes of the vertical interval histogram described in the jSymbolic
 * manual. Each of the bins is associated with a different vertical pitch interval, and is labeled with the
 * number of semitones in that corresponding interval. More specifically, these are numbered from 0 (a unison)
 * to 127 (a vertical interval of 127 semitones). The magnitude of each bin is found by going through a
 * recoding MIDI tick by MIDI tick and noting all vertical intervals that are sounding at each tick, as well
 * as the MIDI velocities of the pair of notes involved in each vertical interval. The end result is a
 * histogram that indicates which vertical intervals are present, and how significant these vertical intervals
 * are relative to one another, with a weighting based on both MIDI velocity and the aggregated durations with
 * which each interval is held throughout the piece. Finally, the histogram is normalized.
 *
 * @author Tristano Tenaglia and Cory McKay
 */
public class VerticalIntervalHistogramFeature
		extends MIDIFeatureExtractor
{
	/* CONSTRUCTOR ******************************************************************************************/

	
	/**
	 * Basic constructor that sets the values of the fields inherited from this class' superclass.
	 */
	public VerticalIntervalHistogramFeature()
<span class="fc" id="L32">	{</span>
<span class="fc" id="L33">		code = &quot;C-1&quot;;</span>
<span class="fc" id="L34">		name = &quot;Vertical Interval Histogram&quot;;</span>
<span class="fc" id="L35">		description = &quot;A feature vector consisting of bin magnitudes of the vertical interval histogram described in the jSymbolic manual. Each of the bins is associated with a different vertical pitch interval, and is labeled with the number of semitones in that corresponding interval. More specifically, these are numbered from 0 (a unison) to 127 (a vertical interval of 127 semitones). The magnitude of each bin is found by going through a recoding MIDI tick by MIDI tick and noting all vertical intervals that are sounding at each tick, as well as the MIDI velocities of the pair of notes involved in each vertical interval. The end result is a histogram that indicates which vertical intervals are present, and how significant these vertical intervals are relative to one another, with a weighting based on both MIDI velocity and the aggregated durations with which each interval is held throughout the piece. Finally, the histogram is normalized.&quot;;</span>
<span class="fc" id="L36">		dimensions = 128; // One for each possible MIDI pitch</span>

<span class="fc" id="L38">	}</span>

	
	/* PUBLIC METHODS ***************************************************************************************/
	
	
	/**
	 * Extract this feature from the given sequence of MIDI data and its associated information.
	 *
	 * @param sequence				The MIDI data to extract the feature from.
	 * @param sequence_info			Additional data already extracted from the the MIDI sequence.
	 * @param other_feature_values	The values of other features that may be needed to calculate this feature. 
	 *								The order and offsets of these features must be the same as those returned
	 *								by this class' getDependencies and getDependencyOffsets methods, 
	 *								respectively. The first indice indicates the feature/window, and the 
	 *								second indicates the value.
	 * @return						The extracted feature value(s).
	 * @throws Exception			Throws an informative exception if the feature cannot be calculated.
	 */
	@Override
	public double[] extractFeature( Sequence sequence,
									MIDIIntermediateRepresentations sequence_info,
									double[][] other_feature_values )
	throws Exception
	{
<span class="fc" id="L63">		double[] vertical_interval_histogram = null;</span>
		
<span class="pc bpc" id="L65" title="1 of 2 branches missed.">		if (sequence_info != null)</span>
		{
			// // Initialize the vertical_interval_histogram and get the value for unisons
<span class="fc" id="L68">			vertical_interval_histogram = new double[128];</span>
<span class="fc" id="L69">			vertical_interval_histogram[0] = sequence_info.total_vertical_unison_velocity;</span>

			// Get the pitch_strength_by_tick_chart
<span class="fc" id="L72">			short[][] pitch_strength_by_tick_chart = sequence_info.pitch_strength_by_tick_chart;</span>

			// Fill in vertical_interval_histogram for all intervals other than unisons, up to 127 semitones
<span class="fc bfc" id="L75" title="All 2 branches covered.">			for (int tick = 0; tick &lt; pitch_strength_by_tick_chart.length; tick++)</span>
			{
<span class="fc bfc" id="L77" title="All 2 branches covered.">				for (int pitch = 0; pitch &lt; pitch_strength_by_tick_chart[tick].length - 1; pitch++)</span>
				{
<span class="fc" id="L79">					int pitch_velocity = pitch_strength_by_tick_chart[tick][pitch];</span>
<span class="fc bfc" id="L80" title="All 2 branches covered.">					if (pitch_velocity != 0)</span>
					{
<span class="fc bfc" id="L82" title="All 2 branches covered.">						for (int other_pitch = pitch + 1; other_pitch &lt; pitch_strength_by_tick_chart[tick].length; other_pitch++)</span>
						{
<span class="fc" id="L84">							int other_pitch_velocity = pitch_strength_by_tick_chart[tick][other_pitch];</span>
<span class="fc bfc" id="L85" title="All 2 branches covered.">							if (other_pitch_velocity != 0)</span>
							{
<span class="fc" id="L87">								int interval = other_pitch - pitch;</span>
<span class="fc" id="L88">								int combined_interval_velocity = pitch_velocity + other_pitch_velocity;</span>
<span class="fc" id="L89">								vertical_interval_histogram[interval] += combined_interval_velocity;</span>
							}
						}
					}
				}
			}

			// Normalize the histogram
<span class="fc" id="L97">			vertical_interval_histogram = MathAndStatsMethods.normalize(vertical_interval_histogram);</span>
		}
		
<span class="fc" id="L100">		return vertical_interval_histogram;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>