<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ru"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CommandLine.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jsymbolic-core</a> &gt; <a href="index.source.html" class="el_package">jsymbolic2.processing.cli</a> &gt; <span class="el_source">CommandLine.java</span></div><h1>CommandLine.java</h1><pre class="source lang-java linenums">package jsymbolic2.processing.cli;

import jsymbolic2.configuration.ConfigFileHeaderEnum;
import jsymbolic2.configuration.ConfigurationFileData;
import jsymbolic2.configuration.txtimplementation.ConfigurationFileValidatorTxtImpl;
import jsymbolic2.processing.FeatureExtractionJobProcessor;
import jsymbolic2.processing.PrintStreams;
import jsymbolic2.processing.SaveInfo;
import jsymbolic2.processing.UserFeedbackGenerator;
import jsymbolic2.processing.WindowInfo;

import java.io.File;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.function.Consumer;

import static jsymbolic2.commandline.CommandLineSwitchEnum.default_config_file_path;

class CommandLine implements Consumer&lt;String[]&gt; {
    // To hold feature extraction settings
<span class="fc" id="L24">    final boolean CONVERT_TO_ARFF = true;</span>
<span class="fc" id="L25">    final boolean CONVERT_TO_CSV = true;</span>
<span class="fc" id="L26">    private final String ARFF_FLAG = &quot;-arff&quot;;</span>
<span class="fc" id="L27">    private final String CSV_FLAG = &quot;-csv&quot;;</span>
    private final PrintStreams printStreams;
<span class="fc" id="L29">    private final boolean GUI_PROCESSING = false;</span>

<span class="fc" id="L31">    public CommandLine(PrintStreams printStreams) {</span>
<span class="fc" id="L32">        this.printStreams = printStreams;</span>
<span class="fc" id="L33">    }</span>

    @Override
    public void accept(String[] args) {
        // Try parsing default configuration file if it exists
<span class="nc bnc" id="L38" title="All 4 branches missed.">        if (3 == args.length &amp;&amp; Files.exists(Paths.get(default_config_file_path))) {</span>
            // Try loading configuration file at default path
            try {
<span class="nc" id="L41">                processWithConfigFile(args);</span>
            }

            // Run without configuration file if does not exist at default path
<span class="nc" id="L45">            catch (Exception ex) {</span>
<span class="nc" id="L46">                UserFeedbackGenerator.simplePrintln(printStreams.status_print_stream(), &quot;NON-CRITICAL WARNING: Could not find a configurations file called &quot; + default_config_file_path + &quot;  in the jSymbolic home directory that is valid under current settings. As a result, processing will continue using standard settings (unless specified manually). Although a default configurations file is by no means necessary to use jSymbolic, it is often convenient. You can save one at anytime either manually or using the jSymbolic GUI, if you wish (see the manual for more details).\n&quot;);</span>
<span class="nc" id="L47">                parseNoConfigFileCommandLineAndExtractAndSaveFeatures(args);</span>
<span class="nc" id="L48">            }</span>
<span class="nc" id="L49">            return;</span>
        }
        // Run without configuration file if does not exist at default path
        // Or run without configuration file if does not exist at default path if three are some other
        // number of command line arguments than 3
<span class="nc bnc" id="L54" title="All 2 branches missed.">        if (3 == args.length) {</span>
<span class="nc" id="L55">            UserFeedbackGenerator.simplePrintln(printStreams.status_print_stream(), &quot;NON-CRITICAL WARNING: Could not find a configurations file called &quot; + default_config_file_path + &quot; in the jSymbolic home directory that is valid under current settings. As a result, processing will continue using standard settings (unless specified manually). Although a default configurations file is by no means necessary to use jSymbolic, it is often convenient. You can save one at anytime either manually or using the jSymbolic GUI, if you wish (see the manual for more details).\n&quot;);</span>
        }
<span class="nc" id="L57">        parseNoConfigFileCommandLineAndExtractAndSaveFeatures(args);</span>
<span class="nc" id="L58">    }</span>

    private void processWithConfigFile(String[] args) throws Exception {
<span class="nc" id="L61">        List&lt;File&gt; input_file_list = List.of(new File(args[0]));</span>
<span class="nc" id="L62">        String feature_values_save_path = args[1];</span>
<span class="nc" id="L63">        String feature_definitions_save_path = args[2];</span>
<span class="nc" id="L64">        List&lt;ConfigFileHeaderEnum&gt; config_file_headers_to_check = Arrays.asList(ConfigFileHeaderEnum.FEATURE_HEADER, ConfigFileHeaderEnum.OPTION_HEADER);</span>
<span class="nc" id="L65">        UserFeedbackGenerator.printParsingConfigFileMessage(printStreams.status_print_stream(), default_config_file_path);</span>
<span class="nc" id="L66">        ConfigurationFileData config_file_data = new ConfigurationFileValidatorTxtImpl().parseConfigFile(default_config_file_path, config_file_headers_to_check, printStreams.error_print_stream());</span>
<span class="nc" id="L67">        FeatureExtractionJobProcessor.extractAndSaveFeaturesConfigFileSettings(input_file_list,</span>
                config_file_data,
                feature_values_save_path,
                feature_definitions_save_path,
                printStreams, GUI_PROCESSING);
<span class="nc" id="L72">    }</span>

    private void parseNoConfigFileCommandLineAndExtractAndSaveFeatures(String[] args) {
        // Find out if CSV and/or ARFF files should be generated. Create reduced_args to hold the command line
        // arguments with CSV or ARFF flags, if any, removed.
<span class="nc" id="L77">        String[] reduced_args = new String[args.length];</span>
<span class="nc" id="L78">        System.arraycopy(args, 0, reduced_args, 0, reduced_args.length);</span>
<span class="nc bnc" id="L79" title="All 4 branches missed.">        if (2 &lt; args.length &amp;&amp; firstOrSecondArgumentIsArffOrCsvFlag(args)) {</span>
<span class="nc" id="L80">            reduced_args = createReducedArgs(args);</span>
        }

        // If there are a proper number of command line arguments, assuming no windowing
<span class="nc bnc" id="L84" title="All 2 branches missed.">        if (3 == reduced_args.length) {</span>
<span class="nc" id="L85">            processNoWindowing(reduced_args);</span>
<span class="nc" id="L86">            return;</span>
        }
        // If proper command line arguments are present for windowing
<span class="nc bnc" id="L89" title="All 2 branches missed.">        if (argumentsContainWindowFlag(reduced_args)) {</span>
<span class="nc" id="L90">            processWindowing(reduced_args);</span>
<span class="nc" id="L91">            return;</span>
        }
        // Indicate invalid choice of command line arguments
<span class="nc" id="L94">        UserFeedbackGenerator.indicateIncorrectCommandLineArgumentsAndEndExecution(printStreams.error_print_stream(), args);</span>
<span class="nc" id="L95">    }</span>

    private void processNoWindowing(String[] reduced_args) {
<span class="nc" id="L98">        String input_file_path = reduced_args[0];</span>
<span class="nc" id="L99">        String ace_xml_feature_values_file_path = reduced_args[1];</span>
<span class="nc" id="L100">        String ace_xml_feature_definitions_file_path = reduced_args[2];</span>
<span class="nc" id="L101">        boolean save_overall_recording_features = true;</span>
<span class="nc" id="L102">        SaveInfo saveInfo = new SaveInfo(ace_xml_feature_values_file_path, ace_xml_feature_definitions_file_path, save_overall_recording_features, CONVERT_TO_ARFF, CONVERT_TO_CSV);</span>

<span class="nc" id="L104">        boolean save_features_for_each_window = false;</span>
<span class="nc" id="L105">        double window_size = 0.0;</span>
<span class="nc" id="L106">        double window_overlap = 0.0;</span>
<span class="nc" id="L107">        WindowInfo windowInfo = new WindowInfo(save_features_for_each_window, window_size, window_overlap);</span>

<span class="nc" id="L109">        FeatureExtractionJobProcessor.extractAndSaveDefaultFeatures(input_file_path,</span>
                saveInfo,
                windowInfo,
                printStreams,
                GUI_PROCESSING);
<span class="nc" id="L114">    }</span>

    private void processWindowing(String[] reduced_args) {
<span class="nc" id="L117">        String input_file_path = reduced_args[1];</span>
<span class="nc" id="L118">        String ace_xml_feature_values_file_path = reduced_args[2];</span>
<span class="nc" id="L119">        String ace_xml_feature_definitions_file_path = reduced_args[3];</span>
<span class="nc" id="L120">        boolean save_features_for_each_window = true;</span>
<span class="nc" id="L121">        boolean save_overall_recording_features = false;</span>
<span class="nc" id="L122">        double window_size = Double.parseDouble(reduced_args[4]);</span>
<span class="nc" id="L123">        double window_overlap = Double.parseDouble(reduced_args[5]);</span>

<span class="nc" id="L125">        SaveInfo saveInfo = new SaveInfo(ace_xml_feature_values_file_path, ace_xml_feature_definitions_file_path, save_overall_recording_features, CONVERT_TO_ARFF, CONVERT_TO_CSV);</span>
<span class="nc" id="L126">        WindowInfo windowInfo = new WindowInfo(save_features_for_each_window, window_size, window_overlap);</span>
<span class="nc" id="L127">        FeatureExtractionJobProcessor.extractAndSaveDefaultFeatures(input_file_path,</span>
                saveInfo, windowInfo,
                printStreams, GUI_PROCESSING);
<span class="nc" id="L130">    }</span>

    private String[] createReducedArgs(String[] args) {
        String[] reduced_args;
<span class="nc" id="L134">        List&lt;String&gt; reduced_args_list = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">        for (String arg : args) {</span>
<span class="nc bnc" id="L136" title="All 4 branches missed.">            if (!arg.equalsIgnoreCase(CSV_FLAG) &amp;&amp; !arg.equalsIgnoreCase(ARFF_FLAG))</span>
<span class="nc" id="L137">                reduced_args_list.add(arg);</span>
        }
<span class="nc" id="L139">        reduced_args = reduced_args_list.toArray(new String[0]);</span>
<span class="nc" id="L140">        return reduced_args;</span>
    }

    private boolean firstOrSecondArgumentIsArffOrCsvFlag(String[] args) {
<span class="nc bnc" id="L144" title="All 2 branches missed.">        return args[0].equalsIgnoreCase(CSV_FLAG) ||</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">                args[0].equalsIgnoreCase(ARFF_FLAG) ||</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">                args[1].equalsIgnoreCase(CSV_FLAG) ||</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">                args[1].equalsIgnoreCase(ARFF_FLAG);</span>
    }

    private boolean argumentsContainWindowFlag(String[] reduced_args) {
        // Define search patterns for parsing command line arguments
<span class="nc" id="L152">        String windowSizePattern = &quot;\\d*.?\\d*&quot;;</span>
<span class="nc" id="L153">        String windowFlag = &quot;-window&quot;;</span>
<span class="nc" id="L154">        String windowOffsetPattern = &quot;0?.\\d*&quot;;</span>
<span class="nc bnc" id="L155" title="All 4 branches missed.">        return 6 == reduced_args.length &amp;&amp; reduced_args[0].equals(windowFlag) &amp;&amp;</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">                reduced_args[4].matches(windowSizePattern) &amp;&amp;</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">                reduced_args[5].matches(windowOffsetPattern);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>